<!DOCTYPE html><html lang=zh-CN data-theme=light><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=no"><title>连续批处理策略（Continuous Batching） | Chase的博客</title><meta name=keywords content=llm><meta name=author content="Chase Woo"><meta name=copyright content="Chase Woo"><meta name=format-detection content="telephone=no"><meta name=theme-color content=#f7f9fe><meta name=mobile-web-app-capable content=yes><meta name=apple-touch-fullscreen content=yes><meta name=apple-mobile-web-app-title content="连续批处理策略（Continuous Batching）"><meta name=application-name content="连续批处理策略（Continuous Batching）"><meta name=apple-mobile-web-app-capable content=yes><meta name=apple-mobile-web-app-status-bar-style content=#f7f9fe><meta property=og:type content=article><meta property=og:title content="连续批处理策略（Continuous Batching）"><meta property=og:url content=http://example.com/2025/10/14/%E8%BF%9E%E7%BB%AD%E6%89%B9%E5%A4%84%E7%90%86%E7%AD%96%E7%95%A5/index.html><meta property=og:site_name content=Chase的博客><meta property=og:description content=大模型部署在本地的一种策略><meta property=og:locale content=zh-CN><meta property=og:image content=http://example.com/src/img/cover/A_futuristic_image_depicting_the_batch_processing_-1760454106886.png><meta property=article:author content="Chase Woo"><meta property=article:tag><meta name=twitter:card content=summary><meta name=twitter:image content=http://example.com/src/img/cover/A_futuristic_image_depicting_the_batch_processing_-1760454106886.png><meta name=description content=大模型部署在本地的一种策略><link rel="shortcut icon" href=/src/icon/fujin-shape.svg><link rel=canonical href=http://example.com/2025/10/14/%E8%BF%9E%E7%BB%AD%E6%89%B9%E5%A4%84%E7%90%86%E7%AD%96%E7%95%A5/ ><link rel=preconnect href=//cdn.cbd.int><meta name=google-site-verification content=xxx><meta name=baidu-site-verification content=code-xxx><meta name=msvalidate.01 content=xxx><link rel=stylesheet href=/css/index.css><link rel=stylesheet href=https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css media=print onload='this.media="all"'><link rel=stylesheet href=https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css media=print onload='this.media="all"'><script>let GLOBAL_CONFIG={linkPageTop:void 0,peoplecanvas:void 0,postHeadAiDescription:{enable:!0,gptName:"AnZhiYu",mode:"local",switchBtn:!1,btnLink:"https://afdian.net/item/886a79d4db6711eda42a52540025c377",randomNum:3,basicWordCount:1e3,key:"xxxx",Referer:"https://xx.xx/"},diytitle:void 0,LA51:void 0,greetingBox:void 0,twikooEnvId:"",commentBarrageConfig:void 0,music_page_default:"nav_music",root:"/",preloader:{source:3},friends_vue_info:void 0,navMusic:!0,mainTone:void 0,authorStatus:{skills:["🤖️ 数码科技爱好者","🔍 团队协作常分享","🔫 代码能力不一般","🔨 设计开发样样通","💡 没头没脑爱钻研","🏃 脚踏实地行动派","🃏 魔术花切都很菜","🙈 人不狠但话不少"]},algolia:void 0,localSearch:{path:"/search.xml",preload:!0,languages:{hits_empty:"找不到您查询的内容：${query}"}},translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"繁",msgToSimplifiedChinese:"简",rightMenuMsgToTraditionalChinese:"转为繁体",rightMenuMsgToSimplifiedChinese:"转为简体"},noticeOutdate:void 0,highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:330},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,simplehomepage:!0,post:!1},runtime:"天",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:{copy:!0,copyrightEbable:!1,limitCount:50,languages:{author:"作者: Chase Woo",link:"链接: ",source:"来源: Chase的博客",info:"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。",copySuccess:"复制成功，复制和转载请标注本文地址"}},lightbox:"fancybox",Snackbar:{chs_to_cht:"你已切换为繁体",cht_to_chs:"你已切换为简体",day_to_night:"你已切换为深色模式",night_to_day:"你已切换为浅色模式",bgLight:"#425AEF",bgDark:"#1f1f1f",position:"top-center"},source:{justifiedGallery:{js:"https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js",css:"https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css"}},isPhotoFigcaption:!1,islazyload:!0,isAnchor:!1,shortcutKey:void 0,autoDarkmode:!0}</script><script id=config-diff>var GLOBAL_CONFIG_SITE={configTitle:"Chase的博客",title:"连续批处理策略（Continuous Batching）",postAI:"",pageFillDescription:"连续批处理策略（Continuous Batching）, 一、批处理策略, 1. 时间轴, 2. 服务器调度策略, 3. 为什么不是快的先完成？, 二、测试, 1. Chunk 完全交错到达（最重要的证据）, 2. 首字延迟差异巨大但总时间趋同, 3. 批处理的三个阶段, 三、结论, 1. 服务器采用了 Continuous Batching + 同步返回策略, 2. 这样设计的优势, 3. 代价, 总结连续批处理策略在调用本地昇腾部署的大模型时观察到一个很有意思的现象在执行高并发问答时所有的回答都趋于同一个短暂的时间窗口完成即使有不同的首字延迟时间关键词批处理大语言模型本地部署图像分析成功响应用时秒首字延迟秒输入输出总秒图像分析成功响应用时秒首字延迟秒输入输出总秒图像分析成功响应用时秒首字延迟秒输入输出总秒图像分析成功响应用时秒首字延迟秒输入输出总秒一批处理策略推理服务器尤其是使用等框架通常会采用连续批处理策略时间轴请求等待首字生成请求等待首字生成请求等待首字生成所有请求在同一批次中完成虽然首字返回时间不同但服务器会将同时到达的请求组成一个批次在上并行处理这个批次批次内的请求会相互等待直到整批完成总时间首字延迟生成时间这也就意味着部分请求可能已经很早就完成了但是需要等待其他请求部分请求的首字仅需不到秒但是后续需要时间过长且总时间与其他请求相差不多请求首字秒后续秒秒总时间请求首字秒后续秒秒总时间服务器调度策略可能使用了公平调度或批次同步机制保证同一批次的请求不会因为完成早就立即返回而是等待批次内所有请求都处理完这样可以优化利用率和简化调度逻辑为什么不是快的先完成虽然是异步流式响应但服务器端的批处理机制决定了即使客户端异步接收服务器端仍然是批量同步推理这导致同一批次的请求几乎同时完成二测试在循环开始时记录每个到达的时间请求收到时间完全交错到达最重要的证据看第一批请求的顺序时间戳第轮时间戳第轮时间戳第轮顺序变化这说明服务器并非逐个处理请求而是在批次中并行生成所有请求的每生成一轮就轮流返回每个请求的类似时间片轮转的调度方式首字延迟差异巨大但总时间趋同请求首字延迟总时间首字后耗时秒秒秒秒秒秒秒秒秒秒秒秒公式首字延迟首字后耗时恒定值秒批处理的三个阶段阶段等待队列调度首字延迟秒请求先进入秒请求批量进入相隔秒秒请求进入相隔秒阶段并行推理交错返回秒所有个请求的交错返回秒第轮秒第轮每轮间隔约毫秒说明批次推理速度很快阶段同步完成所有请求在的同一秒内完成总时间秒误差仅秒三结论服务器采用了同步返回策略伪代码服务器端推理逻辑组成批次在上并行生成所有请求的下一个轮流发送每个请求的等待最慢的请求关键批次同步点所有请求一起返回完成状态这样设计的优势利用率最大化所有请求并行推理充分利用并行能力吞吐量最优批处理比逐个处理快得多调度简化批次内同步避免频繁的上下文切换代价快的请求需要等待慢的请求所以即使首字延迟只有秒也要等到秒才能完成总结观察到的现象首字快的应该先完成但实际没有原因服务器端批处理策略强制同步了所有请求为了最大化吞吐量牺牲了单个请求的延迟优化这是典型的吞吐量优先而非延迟优先的设计如果想要快的先完成需要服务器配置改为更小的或禁用批处理但这会大幅降低整体吞吐量",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2025-12-13 23:22:47",postMainColor:""}</script><noscript><style type=text/css>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:(e,t,a)=>{var o;0!==a&&(o=Date.now(),localStorage.setItem(e,JSON.stringify({value:t,expiry:o+864e5*a})))},get:e=>{var t=localStorage.getItem(e);if(t){t=JSON.parse(t);if(!(Date.now()>t.expiry))return t.value;localStorage.removeItem(e)}}},e.getScript=(o,c={})=>new Promise((t,e)=>{let a=document.createElement("script");a.src=o,a.async=!0,a.onerror=e,a.onload=a.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},Object.keys(c).forEach(e=>{a.setAttribute(e,c[e])}),document.head.appendChild(a)}),e.getCSS=(o,c=!1)=>new Promise((t,e)=>{let a=document.createElement("link");a.rel="stylesheet",a.href=o,c&&(a.id=c),a.onerror=e,a.onload=a.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},document.head.appendChild(a)}),e.activateDarkMode=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#18171d")},e.activateLightMode=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#f7f9fe")};var e=saveToLocal.get("theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches,a=window.matchMedia("(prefers-color-scheme: light)").matches,o=window.matchMedia("(prefers-color-scheme: no-preference)").matches,c=!t&&!a&&!o,t=(void 0===e?(a?activateLightMode():t?activateDarkMode():(o||c)&&((a=(new Date).getHours())<=6||18<=a?activateDarkMode:activateLightMode)(),window.matchMedia("(prefers-color-scheme: dark)").addListener(e=>{void 0===saveToLocal.get("theme")&&(e.matches?activateDarkMode:activateLightMode)()})):("light"===e?activateLightMode:activateDarkMode)(),saveToLocal.get("aside-status"));void 0!==t&&("hide"===t?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><meta name=generator content="Hexo 7.3.0"></head><body data-type=anzhiyu><div id=web_bg></div><div id=an_music_bg></div><div id=loading-box onclick=document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)><div class=loading-bg><img class="loading-img nolazyload" alt=加载头像 src=https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg><div class=loading-image-dot></div></div></div><script>let preloader={endLoading:()=>{document.getElementById("loading-box").classList.add("loaded")},initLoading:()=>{document.getElementById("loading-box").classList.remove("loaded")}};window.addEventListener("load",()=>{preloader.endLoading()}),setTimeout(function(){preloader.endLoading()},1e4),document.addEventListener("pjax:send",()=>{preloader.initLoading()}),document.addEventListener("pjax:complete",()=>{preloader.endLoading()})</script><link rel=stylesheet href=https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css><script async=async src=https://cdn.cbd.int/pace-js@1.2.4/pace.min.js data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class=post id=body-wrap><header class=post-bg id=page-header><nav id=nav><div id=nav-group><span id=blog_name><div class=back-home-button><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class=back-menu-list-groups><div class=back-menu-list-group><div class=back-menu-list-title>网页</div><div class=back-menu-list><a class=back-menu-item target=_blank rel=noopener href=https://blog.anheyu.com/ title=博客><img class=back-menu-item-icon src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=/img/favicon.ico alt=博客><span class=back-menu-item-text>博客</span></a></div></div><div class=back-menu-list-group><div class=back-menu-list-title>项目</div><div class=back-menu-list><a class=back-menu-item target=_blank rel=noopener href=https://image.anheyu.com/ title=安知鱼图床><img class=back-menu-item-icon src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=https://image.anheyu.com/favicon.ico alt=安知鱼图床><span class=back-menu-item-text>安知鱼图床</span></a></div></div></div></div><a id=site-name href=/ accesskey=h><div class=title>Chase的博客</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id=he-plugin-simple></div><script>var WIDGET={CONFIG:{modules:"0124",background:"2",tmpColor:"FFFFFF",tmpSize:"16",cityColor:"FFFFFF",citySize:"16",aqiColor:"E8D87B",aqiSize:"16",weatherIconSize:"24",alertIconSize:"18",padding:"10px 10px 10px 10px",shadow:"0",language:"auto",borderRadius:"20",fixed:"true",vertical:"top",horizontal:"left",left:"20",top:"7.1",key:"df245676fb434a0691ead1c63341cd94"}}</script><link rel=stylesheet href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class=mask-name-container><div id=name-container><a id=page-name href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id=menus><div class=menus_items><div class=menus_item><a class=site-page href=javascript:void(0);><span>文章</span></a><ul class=menus_item_child><li><a class="site-page child faa-parent animated-hover" href=/archives/ ><svg class="icon faa-tada" aria-hidden=true><use xlink:href=#icon-box-archive></use></svg><span>隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href=/categories/ ><svg class="icon faa-tada" aria-hidden=true><use xlink:href=#icon-shapes></use></svg><span>分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href=/tags/ ><svg class="icon faa-tada" aria-hidden=true><use xlink:href=#icon-tags></use></svg><span>标签</span></a></li></ul></div><div class=menus_item><a class=site-page href=javascript:void(0);><span>我的</span></a><ul class=menus_item_child><li><a class="site-page child faa-parent animated-hover" href=/equipment/ ><svg class="icon faa-tada" aria-hidden=true><use xlink:href=#icon-dice-d20></use></svg><span>我的装备</span></a></li><li><a class="site-page child faa-parent animated-hover" href=/essay/ ><svg class="icon faa-tada" aria-hidden=true><use xlink:href=#icon-lightbulb></use></svg><span>即刻说说</span></a></li></ul></div><div class=menus_item><a class=site-page href=javascript:void(0);><span>关于</span></a><ul class=menus_item_child><li><a class="site-page child faa-parent animated-hover" href=/about/ ><svg class="icon faa-tada" aria-hidden=true><use xlink:href=#icon-paper-plane></use></svg><span>关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href=/link/ ><svg class="icon faa-tada" aria-hidden=true><use xlink:href=#icon-link></use></svg><span>友人帐</span></a></li></ul></div></div></div><div id=nav-right><div class=nav-button id=randomPost_button><a class=site-page onclick=toRandomPost() title=随机前往一个文章 href=javascript:void(0);><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class=nav-button id=search-button><a class="site-page social-icon search" href=javascript:void(0); title=搜索🔍 accesskey=s><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id=center-console type=checkbox><label class=widget for=center-console title=中控台 onclick=anzhiyu.switchConsole()><i class=left></i><i class="widget center"></i><i class="widget right"></i></label><div id=console><div class=console-card-group-reward><ul class="reward-all console-card"><li class=reward-item><a href=/src/img/IMG_wx2.JPG target=_blank><img class=post-qr-code-img alt=微信 src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=/src/img/IMG_wx2.JPG></a><div class=post-qr-code-desc>微信</div></li><li class=reward-item><a href=/src/img/IMG_wx2.JPG target=_blank><img class=post-qr-code-img alt=微信 src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=/src/img/IMG_wx2.JPG></a><div class=post-qr-code-desc>微信</div></li></ul></div><div class=console-card-group><div class=console-card-group-left><div class=console-card id=card-newest-comments><div class=card-content><div class=author-content-item-tips>互动</div><span class=author-content-item-title>最新评论</span></div><div class=aside-list><span>正在加载中...</span></div></div></div><div class=console-card-group-right><div class="console-card tags"><div class=card-content><div class=author-content-item-tips>兴趣点</div><span class=author-content-item-title>寻找你感兴趣的领域</span><div class=card-tags><div class=item-headline></div><div class=card-tag-cloud><a href=/tags/llm/ style=font-size:1.05rem>llm<sup>2</sup></a><a href=/tags/macos/ style=font-size:1.05rem>macos<sup>1</sup></a><a href=/tags/ohmyzsh/ style=font-size:1.05rem>ohmyzsh<sup>2</sup></a><a href=/tags/pycharm/ style=font-size:1.05rem>pycharm<sup>1</sup></a><a href=/tags/%E7%BB%88%E7%AB%AF/ style=font-size:1.05rem>终端<sup>3</sup></a></div></div><hr></div></div><div class="console-card history"><div class=item-headline><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class=card-archives><div class=item-headline><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class=card-archive-list><li class=card-archive-list-item><a class=card-archive-list-link href=/archives/2025/12/ ><span class=card-archive-list-date>十二月 2025</span><div class=card-archive-list-count-group><span class=card-archive-list-count>1</span><span>篇</span></div></a></li><li class=card-archive-list-item><a class=card-archive-list-link href=/archives/2025/10/ ><span class=card-archive-list-date>十月 2025</span><div class=card-archive-list-count-group><span class=card-archive-list-count>1</span><span>篇</span></div></a></li><li class=card-archive-list-item><a class=card-archive-list-link href=/archives/2024/12/ ><span class=card-archive-list-date>十二月 2024</span><div class=card-archive-list-count-group><span class=card-archive-list-count>1</span><span>篇</span></div></a></li><li class=card-archive-list-item><a class=card-archive-list-link href=/archives/2024/07/ ><span class=card-archive-list-date>七月 2024</span><div class=card-archive-list-count-group><span class=card-archive-list-count>1</span><span>篇</span></div></a></li><li class=card-archive-list-item><a class=card-archive-list-link href=/archives/2023/07/ ><span class=card-archive-list-date>七月 2023</span><div class=card-archive-list-count-group><span class=card-archive-list-count>3</span><span>篇</span></div></a></li><li class=card-archive-list-item><a class=card-archive-list-link href=/archives/2020/04/ ><span class=card-archive-list-date>四月 2020</span><div class=card-archive-list-count-group><span class=card-archive-list-count>1</span><span>篇</span></div></a></li></ul></div><hr></div></div></div><div class=button-group><div class=console-btn-item><a class=darkmode_switchbutton title=显示模式切换 href=javascript:void(0);><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class=console-btn-item id=consoleHideAside onclick=anzhiyu.hideAsideBtn() title=边栏显示控制><a class=asideSwitch><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class=console-btn-item id=consoleMusic onclick=anzhiyu.musicToggle() title=音乐开关><a class=music-switch><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class=console-mask onclick=anzhiyu.hideConsole() href=javascript:void(0);></div></div><div class=nav-button id=nav-totop><a class=totopbtn href=javascript:void(0);><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id=percent onclick=anzhiyu.scrollToDest(0,500)>0</span></a></div><div id=toggle-menu><a class=site-page href=javascript:void(0); title=切换><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id=post-info><div id=post-firstinfo><div class=meta-firstline><a class=post-meta-original>原创</a><span class=post-meta-categories><span class=post-meta-separator></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class=post-meta-categories href=/categories/%E6%8A%80%E6%9C%AF%E4%BA%BA%E7%94%9F/ itemprop=url>技术人生</a></span><span class="article-meta tags"><a class=article-meta__tags href=/tags/llm/ tabindex=-1 itemprop=url> <span><i class="anzhiyufont anzhiyu-icon-hashtag"></i>llm</span></a></span></div></div><h1 class=post-title itemprop="name headline">连续批处理策略（Continuous Batching）</h1><div id=post-meta><div class=meta-firstline><span class=post-meta-date><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class=post-meta-label>发表于</span><time class=post-meta-date-created itemprop="dateCreated datePublished" datetime=2025-10-14T14:55:00.000Z title="发表于 2025-10-14 22:55:00">2025-10-14</time><span class=post-meta-separator></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class=post-meta-label>更新于</span><time class=post-meta-date-updated itemprop="dateCreated datePublished" datetime=2025-12-13T15:22:47.767Z title="更新于 2025-12-13 23:22:47">2025-12-13</time></span></div><div class=meta-secondline><span class=post-meta-separator></span><span class=post-meta-wordcount><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title=文章字数></i><span class=post-meta-label title=文章字数>字数总计:</span><span class=word-count title=文章字数>1.4k</span><span class=post-meta-separator></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title=阅读时长></i><span class=post-meta-label title=阅读时长>阅读时长:</span><span>5分钟</span></span><span class=post-meta-separator> </span><span class=post-meta-position title=作者IP属地为杭州><i class="anzhiyufont anzhiyu-icon-location-dot"></i>杭州</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class=waves-svg xmlns=http://www.w3.org/2000/svg xlink=http://www.w3.org/1999/xlink viewBox="0 24 150 28" preserveAspectRatio=none shape-rendering=auto><defs><path id=gentle-wave d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class=parallax><use href=#gentle-wave x=48 y=0></use><use href=#gentle-wave x=48 y=3></use><use href=#gentle-wave x=48 y=5></use><use href=#gentle-wave x=48 y=7></use></g></svg></section><div id=post-top-cover><img class=nolazyload id=post-top-bg src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=/src/img/cover/A_futuristic_image_depicting_the_batch_processing_-1760454106886.png></div></header><main id=blog-container><div class=layout id=content-inner><div id=post><article class=post-content id=article-container itemscope itemtype=http://example.com/2025/10/14/%E8%BF%9E%E7%BB%AD%E6%89%B9%E5%A4%84%E7%90%86%E7%AD%96%E7%95%A5/ ><header><a class=post-meta-categories href=/categories/%E6%8A%80%E6%9C%AF%E4%BA%BA%E7%94%9F/ itemprop=url>技术人生</a><a href=/tags/llm/ tabindex=-1 itemprop=url>llm</a><h1 id=CrawlerTitle itemprop="name headline">连续批处理策略（Continuous Batching）</h1><span itemprop=author itemscope itemtype=http://schema.org/Person>Chase Woo</span><time itemprop="dateCreated datePublished" datetime=2025-10-14T14:55:00.000Z title="发表于 2025-10-14 22:55:00">2025-10-14</time><time itemprop="dateCreated datePublished" datetime=2025-12-13T15:22:47.767Z title="更新于 2025-12-13 23:22:47">2025-12-13</time></header><h1 id=连续批处理策略（Continuous-Batching）><a href=#连续批处理策略（Continuous-Batching） class=headerlink title="连续批处理策略（Continuous Batching）"></a>连续批处理策略（Continuous Batching）</h1><p>在调用本地昇腾部署的大模型时，观察到一个很有意思的现象：在执行高并发问答时，所有的回答都趋于同一个短暂的时间窗口完成，即使有不同的首字延迟时间。</p><p>关键词： 批处理、大语言模型、本地部署</p><figure class="highlight text"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre></td><td class=code><pre><span class=line>2025-10-10 11:04:08 [INFO] LLM图像分析455成功响应，用时 86.08秒 | 首字延迟: 63.554秒 | 输入tokens: 872 | 输出tokens: 8 | 总tokens: 880 | tokens/秒: 0.09</span><br><span class=line>2025-10-10 11:04:08 [INFO] LLM图像分析471成功响应，用时 85.91秒 | 首字延迟: 26.541秒 | 输入tokens: 872 | 输出tokens: 8 | 总tokens: 880 | tokens/秒: 0.09</span><br><span class=line>2025-10-10 11:04:08 [INFO] LLM图像分析263成功响应，用时 88.34秒 | 首字延迟: 7.496秒 | 输入tokens: 872 | 输出tokens: 8 | 总tokens: 880 | tokens/秒: 0.09</span><br><span class=line>2025-10-10 11:04:08 [INFO] LLM图像分析375成功响应，用时 87.13秒 | 首字延迟: 45.048秒 | 输入tokens: 872 | 输出tokens: 8 | 总tokens: 880 | tokens/秒: 0.09</span><br></pre></td></tr></table></figure><h2 id=一、批处理策略><a href=#一、批处理策略 class=headerlink title=一、批处理策略></a>一、批处理策略</h2><p>LLM推理服务器（尤其是使用vLLM、TensorRT-LLM等框架）通常会采用 <strong>连续批处理（Continuous Batching）</strong> 策略：</p><h3 id=1-时间轴><a href=#1-时间轴 class=headerlink title="1. 时间轴"></a>1. 时间轴</h3><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre></td><td class=code><pre><span class=line>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span><br><span class=line>请求A: [等待.......][首字][生成...]</span><br><span class=line>请求B: [等待..........][首字][生成]</span><br><span class=line>请求C: [等待....][首字][生成......]</span><br><span class=line>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span><br><span class=line>←      所有请求在同一批次中完成    →</span><br></pre></td></tr></table></figure><p>虽然首字返回时间不同，但服务器会：</p><ul><li>将同时到达的请求组成一个批次</li><li>在GPU上并行处理这个批次</li><li>批次内的请求会<strong>相互等待</strong>，直到整批完成</li></ul><p>总时间 &#x3D; 首字延迟 + 生成时间，这也就意味着部分请求可能已经很早就完成了，但是需要等待其他请求。</p><p>💡部分请求的首字token仅需不到1秒，但是后续需要时间过长，且总时间与其他请求相差不多</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line>请求2:  首字 0.870秒 + 后续 10.48秒 ≈ 11.35秒总时间</span><br><span class=line>请求27: 首字10.824秒 + 后续  0.26秒 ≈ 11.08秒总时间</span><br></pre></td></tr></table></figure><h3 id=2-服务器调度策略><a href=#2-服务器调度策略 class=headerlink title="2. 服务器调度策略"></a>2. 服务器调度策略</h3><p>可能使用了<strong>公平调度</strong>或<strong>批次同步</strong>机制：</p><ul><li>保证同一批次的请求不会因为完成早就立即返回</li><li>而是等待批次内所有请求都处理完</li><li>这样可以<strong>优化GPU利用率</strong>和<strong>简化调度逻辑</strong></li></ul><h3 id=3-为什么不是”快的先完成”？><a href=#3-为什么不是”快的先完成”？ class=headerlink title="3. 为什么不是”快的先完成”？"></a>3. 为什么不是”快的先完成”？</h3><p>虽然是异步流式响应，但<strong>服务器端的批处理机制</strong>决定了：</p><ul><li>即使客户端异步接收</li><li>服务器端仍然是<strong>批量同步推理</strong></li><li>这导致同一批次的请求几乎同时完成</li></ul><h2 id=二、测试><a href=#二、测试 class=headerlink title=二、测试></a>二、测试</h2><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><span class=line><span class=comment># 在循环开始时记录每个chunk到达的时间</span></span><br><span class=line><span class=keyword>async</span> <span class=keyword>for</span> chunk <span class=keyword>in</span> <span class="variable language_">self</span>.llm.astream([(<span class=string>&quot;system&quot;</span>, system_prompt), message]):</span><br><span class=line>    <span class=built_in>print</span>(<span class=string>f&quot;请求<span class=subst>&#123;request_id&#125;</span> 收到chunk时间: <span class=subst>&#123;time.time()&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id=1-Chunk-完全交错到达（最重要的证据）><a href=#1-Chunk-完全交错到达（最重要的证据） class=headerlink title="1. Chunk 完全交错到达（最重要的证据）"></a>1. Chunk 完全交错到达（最重要的证据）</h3><p>看第一批请求（115-128）的chunk顺序：</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre></td><td class=code><pre><span class=line>时间戳 <span class=number>1760063687.956</span>-<span class=number>958</span>:</span><br><span class=line><span class=number>127</span> → <span class=number>119</span> → <span class=number>117</span> → <span class=number>120</span> → <span class=number>121</span> → <span class=number>128</span> → <span class=number>126</span> → <span class=number>115</span>  (第<span class=number>1</span>轮)</span><br><span class=line></span><br><span class=line>时间戳 <span class=number>1760063687.959</span>-<span class=number>961</span>:  </span><br><span class=line><span class=number>127</span> → <span class=number>119</span> → <span class=number>117</span> → <span class=number>120</span> → <span class=number>121</span> → <span class=number>128</span> → <span class=number>126</span> → <span class=number>115</span>  (第<span class=number>2</span>轮)</span><br><span class=line></span><br><span class=line>时间戳 <span class=number>1760063687.979</span>-<span class=number>981</span>:</span><br><span class=line><span class=number>119</span> → <span class=number>127</span> → <span class=number>121</span> → <span class=number>117</span> → <span class=number>115</span> → <span class=number>126</span> → <span class=number>120</span> → <span class=number>128</span>  (第<span class=number>3</span>轮，顺序变化)</span><br></pre></td></tr></table></figure><p>这说明<strong>服务器并非逐个处理请求</strong>，而是：</p><ul><li>在<strong>GPU批次中并行生成</strong>所有请求的token</li><li>每生成一轮，就<strong>轮流返回</strong>每个请求的chunk</li><li>类似”时间片轮转”的调度方式</li></ul><h3 id=2-首字延迟差异巨大，但总时间趋同><a href=#2-首字延迟差异巨大，但总时间趋同 class=headerlink title="2. 首字延迟差异巨大，但总时间趋同"></a>2. 首字延迟差异巨大，但总时间趋同</h3><table><thead><tr><th>请求ID</th><th>首字延迟</th><th>总时间</th><th>首字后耗时</th></tr></thead><tbody><tr><td>129</td><td>0.913秒</td><td>5.70秒</td><td>4.79秒</td></tr><tr><td>131</td><td>3.676秒</td><td>5.68秒</td><td>2.00秒</td></tr><tr><td>140</td><td>5.396秒</td><td>5.60秒</td><td>0.20秒</td></tr><tr><td>142</td><td>5.374秒</td><td>5.58秒</td><td>0.21秒</td></tr></tbody></table><p>公式：<strong>首字延迟 + 首字后耗时 ≈ 恒定值（~5.6秒）</strong></p><h3 id=3-批处理的三个阶段><a href=#3-批处理的三个阶段 class=headerlink title=3. 批处理的三个阶段></a>3. 批处理的三个阶段</h3><p><strong>阶段1：等待队列调度（首字延迟）</strong></p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><span class=line><span class=number>1760063688.79</span>秒  ← 请求<span class=number>129</span>, <span class=number>135</span>先进入</span><br><span class=line><span class=number>1760063691.57</span>秒  ← 请求<span class=number>143</span>, <span class=number>138</span>, <span class=number>133</span>, <span class=number>131.</span>.. 批量进入（相隔<span class=number>2.78</span>秒）</span><br><span class=line><span class=number>1760063693.41</span>秒  ← 请求<span class=number>141</span>, <span class=number>139</span>, <span class=number>140</span>, <span class=number>142</span>, <span class=number>144</span> 进入（相隔<span class=number>1.84</span>秒）</span><br></pre></td></tr></table></figure><p><strong>阶段2：并行推理（chunk交错返回）</strong></p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><span class=line><span class=number>1760063693.46</span>-<span class=number>52</span>秒： 所有<span class=number>16</span>个请求的chunk交错返回</span><br><span class=line><span class=number>1760063693.51</span>-<span class=number>52</span>秒： 第<span class=number>2</span>轮chunk</span><br><span class=line><span class=number>1760063693.56</span>-<span class=number>57</span>秒： 第<span class=number>3</span>轮chunk  </span><br></pre></td></tr></table></figure><p>每轮间隔<strong>约50毫秒</strong>，说明GPU批次推理速度很快</p><p><strong>阶段3：同步完成</strong></p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line>所有请求在 <span class=number>10</span>:<span class=number>34</span>:<span class=number>53</span> 的同一秒内完成</span><br><span class=line>总时间：<span class=number>5.55</span>-<span class=number>5.74</span>秒（误差仅<span class=number>0.19</span>秒）</span><br></pre></td></tr></table></figure><h2 id=三、结论><a href=#三、结论 class=headerlink title=三、结论></a>三、结论</h2><h3 id=1-服务器采用了-Continuous-Batching-同步返回策略><a href=#1-服务器采用了-Continuous-Batching-同步返回策略 class=headerlink title="1. 服务器采用了 Continuous Batching + 同步返回策略"></a>1. 服务器采用了 Continuous Batching + 同步返回策略</h3><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br></pre></td><td class=code><pre><span class=line><span class=comment># 伪代码：服务器端推理逻辑</span></span><br><span class=line>batch = [req129, req131, req140, ...]  <span class=comment># 组成批次</span></span><br><span class=line></span><br><span class=line><span class=keyword>while</span> <span class=keyword>not</span> all_completed(batch):</span><br><span class=line>    <span class=comment># 在GPU上并行生成所有请求的下一个token</span></span><br><span class=line>    tokens = gpu_parallel_generate(batch)  </span><br><span class=line>    </span><br><span class=line>    <span class=comment># 轮流发送每个请求的token</span></span><br><span class=line>    <span class=keyword>for</span> req, token <span class=keyword>in</span> <span class=built_in>zip</span>(batch, tokens):</span><br><span class=line>        <span class=keyword>if</span> token != EOS:</span><br><span class=line>            send_chunk_to_client(req, token)</span><br><span class=line>    </span><br><span class=line>    <span class=comment># 等待最慢的请求</span></span><br><span class=line>    wait_for_slowest()  <span class=comment># 关键：批次同步点</span></span><br><span class=line></span><br><span class=line><span class=comment># 所有请求一起返回完成状态</span></span><br><span class=line>return_all_together(batch)</span><br></pre></td></tr></table></figure><h3 id=2-这样设计的优势><a href=#2-这样设计的优势 class=headerlink title="2. 这样设计的优势"></a>2. 这样设计的优势</h3><ol><li><strong>GPU利用率最大化</strong>：所有请求并行推理，充分利用GPU并行能力</li><li><strong>吞吐量最优</strong>：批处理比逐个处理快得多</li><li><strong>调度简化</strong>：批次内同步，避免频繁的上下文切换</li></ol><h3 id=3-代价><a href=#3-代价 class=headerlink title="3. 代价"></a>3. 代价</h3><p>快的请求需要<strong>等待慢的请求</strong>，所以即使首字延迟只有0.9秒，也要等到5.7秒才能完成。</p><h3 id=总结><a href=#总结 class=headerlink title=总结></a>总结</h3><p>观察到的现象：<strong>首字快的应该先完成，但实际没有</strong>。</p><p>原因：<strong>服务器端批处理策略</strong>强制同步了所有请求，为了最大化吞吐量，牺牲了单个请求的延迟优化。这是典型的 <strong>吞吐量优先（Throughput-oriented）</strong> 而非 <strong>延迟优先（Latency-oriented）</strong> 的设计。</p><p>如果想要”快的先完成”，需要服务器配置改为<strong>更小的batch size</strong>或<strong>禁用批处理</strong>，但这会大幅降低整体吞吐量。</p></article><div class=post-copyright><div class=copyright-cc-box><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class=post-copyright__author_box><a class=post-copyright__author_img href=/ title=头像><img class=post-copyright__author_img_back src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=/src/img/avatar.jpeg title=头像 alt=头像><img class=post-copyright__author_img_front src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=/src/img/avatar.jpeg title=头像 alt=头像></a><div class=post-copyright__author_name>Chase Woo</div><div class=post-copyright__author_desc>大繁至简，极境至臻</div></div><div class=post-copyright__post__info><a class=post-copyright__original title=该文章为原创文章，注意版权协议 href=http://example.com/2025/10/14/%E8%BF%9E%E7%BB%AD%E6%89%B9%E5%A4%84%E7%90%86%E7%AD%96%E7%95%A5/ >原创</a><a class=post-copyright-title><span onclick='rm.copyPageUrl("http://example.com/2025/10/14/%E8%BF%9E%E7%BB%AD%E6%89%B9%E5%A4%84%E7%90%86%E7%AD%96%E7%95%A5/")'>连续批处理策略（Continuous Batching）</span></a></div><div class=post-tools id=post-tools><div class=post-tools-left><div class=rewardLeftButton><div class=post-reward onclick=anzhiyu.addRewardMask()><div class="reward-button button--animated" title=赞赏作者><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class=reward-main><div class=reward-all><span class=reward-title>感谢你赐予我前进的力量</span><ul class=reward-group><li class=reward-item><a href=/src/img/IMG_wx2.JPG target=_blank><img class=post-qr-code-img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=/src/img/IMG_wx2.JPG alt=微信></a><div class=post-qr-code-desc>微信</div></li><li class=reward-item><a href=/src/img/IMG_wx2.JPG target=_blank><img class=post-qr-code-img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=/src/img/IMG_wx2.JPG alt=微信></a><div class=post-qr-code-desc>微信</div></li></ul><a class=reward-main-btn href=/about/#about-reward target=_blank><div class=reward-text>赞赏者名单</div><div class=reward-dec>因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id=quit-box onclick=anzhiyu.removeRewardMask() style=display:none></div></div><div class=shareRight><div class="share-link mobile"><div class=share-qrcode><div class=share-button title=使用手机访问这篇文章><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class=share-main><div class=share-main-all><div id=qrcode title=http://example.com/2025/10/14/%E8%BF%9E%E7%BB%AD%E6%89%B9%E5%A4%84%E7%90%86%E7%AD%96%E7%95%A5/ ></div><div class=reward-dec>使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class=share-button target=_blank href="https://service.weibo.com/share/share.php?title=连续批处理策略（Continuous Batching）&amp;url=http://example.com/2025/10/14/%E8%BF%9E%E7%BB%AD%E6%89%B9%E5%A4%84%E7%90%86%E7%AD%96%E7%95%A5/&amp;pic=/src/img/cover/A_futuristic_image_depicting_the_batch_processing_-1760454106886.png" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl(){var e=window.location.href,t=document.createElement("input");t.setAttribute("value",e),document.body.appendChild(t),t.select(),t.setSelectionRange(0,99999),document.execCommand("copy"),document.body.removeChild(t)}</script><div class="share-link copyurl"><div class=share-button id=post-share-url title=复制链接 onclick=copyCurrentPageUrl()><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class=post-copyright__notice><span class=post-copyright-info>本博客所有文章除特别声明外，均采用 <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href=http://example.com target=_blank>Chase的博客</a>！</span></div></div><div class=post-tools-right><div class=tag_share><div class=post-meta__box><div class=post-meta__box__tag-list><a class=post-meta__box__tags href=/tags/llm/ ><span class=tags-punctuation><i class="anzhiyufont anzhiyu-icon-tag"></i></span>llm<span class=tagsPageCount>2</span></a></div></div></div><div class=post_share><div class=social-share data-image=/src/img/cover/An_astronaut_walking_across_the_barren_lunar_surfa-1765638799613.png data-sites=facebook,twitter,wechat,weibo,qq></div><link rel=stylesheet href=https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css media=print onload='this.media="all"'><script src=https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js defer=defer></script></div></div><nav class=pagination-post id=pagination><div class="prev-post pull-left"><a href=/2024/12/02/safebrowsing%E5%81%B7%E8%B7%91%E6%B5%81%E9%87%8F/ ><img class=prev-cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=/src/img/cover/Street_art_style_bold_typography_modern_social_m-1743520392954.png onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class=pagination-info><div class=label>上一篇</div><div class=prev_info>safebrowsing偷跑流量</div></div></a></div><div class="next-post pull-right"><a href=/2025/12/13/%E5%AE%89%E8%A3%85kimi-audio_docker/ ><img class=next-cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=/src/img/cover/An_astronaut_walking_across_the_barren_lunar_surfa-1765638799613.png onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class=pagination-info><div class=label>下一篇</div><div class=next_info>安装Kimi-Audio docker镜像</div></div></a></div></nav><div class=relatedPosts><div class=headline><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style=font-size:1.5rem;margin-right:4px></i><span>喜欢这篇文章的人也看了</span></div><div class=relatedPosts-list><div><a href=/2025/12/13/%E5%AE%89%E8%A3%85kimi-audio_docker/ title="安装Kimi-Audio docker镜像"><img class=cover src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=/src/img/cover/An_astronaut_walking_across_the_barren_lunar_surfa-1765638799613.png alt=cover><div class="content is-center"><div class=date><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-12-13</div><div class=title>安装Kimi-Audio docker镜像</div></div></a></div></div></div></div><div class=aside-content id=aside-content><div class="card-widget card-info"><div class=card-content><div class=author-info__sayhi id=author-info__sayhi onclick=anzhiyu.changeSayHelloText()></div><div class=author-info-avatar><img class=avatar-img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=/src/img/avatar.jpeg onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt=avatar><div class=author-status><img class=g-status src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=/src/icon/grinning.png alt=status></div></div><div class=author-info__description><div style="line-height:1.38;margin:.6rem 0;text-align:justify;color:rgba(255,255,255,.8)">这有关于<b style=color:#fff>AI、开发</b>相关的问题和看法，还有<b style=color:#fff>技术</b>和<b style=color:#fff>分享</b>。</div><div style="line-height:1.38;margin:.6rem 0;text-align:justify;color:rgba(255,255,255,.8)">相信你可以在这里找到对你有用的<b style=color:#fff>知识</b>和<b style=color:#fff>教程</b>。</div></div><div class=author-info__bottom-group><a class=author-info__bottom-group-left href=/ ><h1 class=author-info__name>Chase Woo</h1><div class=author-info__desc>大繁至简，极境至臻</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href=https://github.com/abc5z7 target=_blank title=Github><svg class="icon faa-tada" aria-hidden=true><use xlink:href=#icon-github></use></svg></a><a class="social-icon faa-parent animated-hover" href=https://blog.csdn.net/abc5z7 target=_blank title=csdn><svg class="icon faa-tada" aria-hidden=true><use xlink:href=#icon-csdnlogo></use></svg></a></div></div></div></div><div class="card-widget anzhiyu-right-widget" id=card-wechat onclick=""><div id=flip-wrapper><div id=flip-content><div class=face style="background:url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center/100% no-repeat"></div><div class="back face" style="background:url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center/100% no-repeat"></div></div></div></div><div class=sticky_layout><div class=card-widget id=card-toc><div class=item-headline><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class=toc-percentage></span></div><div class=toc-content><ol class=toc><li class="toc-item toc-level-1"><a class=toc-link href=#%E8%BF%9E%E7%BB%AD%E6%89%B9%E5%A4%84%E7%90%86%E7%AD%96%E7%95%A5%EF%BC%88Continuous-Batching%EF%BC%89><span class=toc-text>连续批处理策略（Continuous Batching）</span></a><ol class=toc-child><li class="toc-item toc-level-2"><a class=toc-link href=#%E4%B8%80%E3%80%81%E6%89%B9%E5%A4%84%E7%90%86%E7%AD%96%E7%95%A5><span class=toc-text>一、批处理策略</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#1-%E6%97%B6%E9%97%B4%E8%BD%B4><span class=toc-text>1. 时间轴</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#2-%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%B0%83%E5%BA%A6%E7%AD%96%E7%95%A5><span class=toc-text>2. 服务器调度策略</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#3-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E6%98%AF%E2%80%9D%E5%BF%AB%E7%9A%84%E5%85%88%E5%AE%8C%E6%88%90%E2%80%9D%EF%BC%9F><span class=toc-text>3. 为什么不是”快的先完成”？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E4%BA%8C%E3%80%81%E6%B5%8B%E8%AF%95><span class=toc-text>二、测试</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#1-Chunk-%E5%AE%8C%E5%85%A8%E4%BA%A4%E9%94%99%E5%88%B0%E8%BE%BE%EF%BC%88%E6%9C%80%E9%87%8D%E8%A6%81%E7%9A%84%E8%AF%81%E6%8D%AE%EF%BC%89><span class=toc-text>1. Chunk 完全交错到达（最重要的证据）</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#2-%E9%A6%96%E5%AD%97%E5%BB%B6%E8%BF%9F%E5%B7%AE%E5%BC%82%E5%B7%A8%E5%A4%A7%EF%BC%8C%E4%BD%86%E6%80%BB%E6%97%B6%E9%97%B4%E8%B6%8B%E5%90%8C><span class=toc-text>2. 首字延迟差异巨大，但总时间趋同</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#3-%E6%89%B9%E5%A4%84%E7%90%86%E7%9A%84%E4%B8%89%E4%B8%AA%E9%98%B6%E6%AE%B5><span class=toc-text>3. 批处理的三个阶段</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E4%B8%89%E3%80%81%E7%BB%93%E8%AE%BA><span class=toc-text>三、结论</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#1-%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%87%87%E7%94%A8%E4%BA%86-Continuous-Batching-%E5%90%8C%E6%AD%A5%E8%BF%94%E5%9B%9E%E7%AD%96%E7%95%A5><span class=toc-text>1. 服务器采用了 Continuous Batching + 同步返回策略</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#2-%E8%BF%99%E6%A0%B7%E8%AE%BE%E8%AE%A1%E7%9A%84%E4%BC%98%E5%8A%BF><span class=toc-text>2. 这样设计的优势</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#3-%E4%BB%A3%E4%BB%B7><span class=toc-text>3. 代价</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%80%BB%E7%BB%93><span class=toc-text>总结</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class=item-headline><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class=aside-list><div class=aside-list-item><a class=thumbnail href=/2025/12/13/%E5%AE%89%E8%A3%85kimi-audio_docker/ title="安装Kimi-Audio docker镜像"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=/src/img/cover/An_astronaut_walking_across_the_barren_lunar_surfa-1765638799613.png onerror='this.onerror=null,this.src="/img/404.jpg"' alt="安装Kimi-Audio docker镜像"></a><div class=content><a class=title href=/2025/12/13/%E5%AE%89%E8%A3%85kimi-audio_docker/ title="安装Kimi-Audio docker镜像">安装Kimi-Audio docker镜像</a><time datetime=2025-12-13T15:15:00.000Z title="发表于 2025-12-13 23:15:00">2025-12-13</time></div></div><div class=aside-list-item><a class=thumbnail href=/2025/10/14/%E8%BF%9E%E7%BB%AD%E6%89%B9%E5%A4%84%E7%90%86%E7%AD%96%E7%95%A5/ title="连续批处理策略（Continuous Batching）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=/src/img/cover/A_futuristic_image_depicting_the_batch_processing_-1760454106886.png onerror='this.onerror=null,this.src="/img/404.jpg"' alt="连续批处理策略（Continuous Batching）"></a><div class=content><a class=title href=/2025/10/14/%E8%BF%9E%E7%BB%AD%E6%89%B9%E5%A4%84%E7%90%86%E7%AD%96%E7%95%A5/ title="连续批处理策略（Continuous Batching）">连续批处理策略（Continuous Batching）</a><time datetime=2025-10-14T14:55:00.000Z title="发表于 2025-10-14 22:55:00">2025-10-14</time></div></div><div class=aside-list-item><a class=thumbnail href=/2024/12/02/safebrowsing%E5%81%B7%E8%B7%91%E6%B5%81%E9%87%8F/ title=safebrowsing偷跑流量><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=/src/img/cover/Street_art_style_bold_typography_modern_social_m-1743520392954.png onerror='this.onerror=null,this.src="/img/404.jpg"' alt=safebrowsing偷跑流量></a><div class=content><a class=title href=/2024/12/02/safebrowsing%E5%81%B7%E8%B7%91%E6%B5%81%E9%87%8F/ title=safebrowsing偷跑流量>safebrowsing偷跑流量</a><time datetime=2024-12-02T08:29:00.000Z title="发表于 2024-12-02 16:29:00">2024-12-02</time></div></div><div class=aside-list-item><a class=thumbnail href=/2024/07/01/pycharm%E6%89%93%E5%AD%97%E5%8D%A1%E9%A1%BF/ title=pycharm打字卡顿><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=/src/img/cover/A_modern_street_art_inspired_illustration_featurin-1743667182573.png onerror='this.onerror=null,this.src="/img/404.jpg"' alt=pycharm打字卡顿></a><div class=content><a class=title href=/2024/07/01/pycharm%E6%89%93%E5%AD%97%E5%8D%A1%E9%A1%BF/ title=pycharm打字卡顿>pycharm打字卡顿</a><time datetime=2024-07-01T14:35:00.000Z title="发表于 2024-07-01 22:35:00">2024-07-01</time></div></div><div class=aside-list-item><a class=thumbnail href=/2023/07/24/%E7%BE%8E%E5%8C%96Mac%E7%BB%88%E7%AB%AF/ title=美化Mac终端><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=/src/img/cover/Realistic_style_image_featuring_Hello_World_at_t-1743667795559.webp onerror='this.onerror=null,this.src="/img/404.jpg"' alt=美化Mac终端></a><div class=content><a class=title href=/2023/07/24/%E7%BE%8E%E5%8C%96Mac%E7%BB%88%E7%AB%AF/ title=美化Mac终端>美化Mac终端</a><time datetime=2023-07-24T07:31:00.000Z title="发表于 2023-07-24 15:31:00">2023-07-24</time></div></div></div></div></div></div></div></main><footer id=footer><div id=footer-wrap><div id=footer_deal><a class=deal_link href=mailto:abcwzcb@163.com title=email><svg class=icon aria-hidden=true><use xlink:href=#icon-envelope></use></svg></a><img class=footer_mini_logo title=返回顶部 alt=返回顶部 onclick=anzhiyu.scrollToDest(0,500) src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=/src/img/avatar.jpeg size=50px><a class=deal_link target=_blank rel=noopener href=https://github.com/abc5z7 title=Github><svg class=icon aria-hidden=true><use xlink:href=#icon-github></use></svg></a><a class=deal_link target=_blank rel=noopener href=https://blog.csdn.net/abc5z7 title=csdn><svg class=icon aria-hidden=true><use xlink:href=#icon-csdnlogo></use></svg></a></div></div><div id=footer-bar><div class=footer-bar-links><div class=footer-bar-left><div id=footer-bar-tips><div class=copyright>&copy;2020 - 2025 By <a class=footer-bar-link href=/ title="Chase Woo" target=_blank>Chase Woo</a></div></div><div id=footer-type-tips></div></div><div class=footer-bar-right><a class=footer-bar-link target=_blank rel=noopener href=https://github.com/anzhiyu-c/hexo-theme-anzhiyu title=主题>主题</a></div></div></div></footer></div><div id=sidebar><div id=menu-mask></div><div id=sidebar-menus><div class="sidebar-site-data site-data is-center"><a href=/archives/ title=archive><div class=headline>文章</div><div class=length-num>8</div></a><a href=/tags/ title=tag><div class=headline>标签</div><div class=length-num>5</div></a><a href=/categories/ title=category><div class=headline>分类</div><div class=length-num>1</div></a></div><span class=sidebar-menu-item-title>功能</span><div class=sidebar-menu-item><a class="darkmode_switchbutton menu-child" href=javascript:void(0); title=显示模式><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class=back-menu-list-groups><div class=back-menu-list-group><div class=back-menu-list-title>网页</div><div class=back-menu-list><a class=back-menu-item target=_blank rel=noopener href=https://blog.anheyu.com/ title=博客><img class=back-menu-item-icon src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=/img/favicon.ico alt=博客><span class=back-menu-item-text>博客</span></a></div></div><div class=back-menu-list-group><div class=back-menu-list-title>项目</div><div class=back-menu-list><a class=back-menu-item target=_blank rel=noopener href=https://image.anheyu.com/ title=安知鱼图床><img class=back-menu-item-icon src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src=https://image.anheyu.com/favicon.ico alt=安知鱼图床><span class=back-menu-item-text>安知鱼图床</span></a></div></div></div><div class=menus_items><div class=menus_item><a class=site-page href=javascript:void(0);><span>文章</span></a><ul class=menus_item_child><li><a class="site-page child faa-parent animated-hover" href=/archives/ ><svg class="icon faa-tada" aria-hidden=true><use xlink:href=#icon-box-archive></use></svg><span>隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href=/categories/ ><svg class="icon faa-tada" aria-hidden=true><use xlink:href=#icon-shapes></use></svg><span>分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href=/tags/ ><svg class="icon faa-tada" aria-hidden=true><use xlink:href=#icon-tags></use></svg><span>标签</span></a></li></ul></div><div class=menus_item><a class=site-page href=javascript:void(0);><span>我的</span></a><ul class=menus_item_child><li><a class="site-page child faa-parent animated-hover" href=/equipment/ ><svg class="icon faa-tada" aria-hidden=true><use xlink:href=#icon-dice-d20></use></svg><span>我的装备</span></a></li><li><a class="site-page child faa-parent animated-hover" href=/essay/ ><svg class="icon faa-tada" aria-hidden=true><use xlink:href=#icon-lightbulb></use></svg><span>即刻说说</span></a></li></ul></div><div class=menus_item><a class=site-page href=javascript:void(0);><span>关于</span></a><ul class=menus_item_child><li><a class="site-page child faa-parent animated-hover" href=/about/ ><svg class="icon faa-tada" aria-hidden=true><use xlink:href=#icon-paper-plane></use></svg><span>关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href=/link/ ><svg class="icon faa-tada" aria-hidden=true><use xlink:href=#icon-link></use></svg><span>友人帐</span></a></li></ul></div></div><span class=sidebar-menu-item-title>标签</span><div class=card-tags><div class=item-headline></div><div class=card-tag-cloud><a href=/tags/llm/ style=font-size:.88rem>llm<sup>2</sup></a><a href=/tags/macos/ style=font-size:.88rem>macos<sup>1</sup></a><a href=/tags/ohmyzsh/ style=font-size:.88rem>ohmyzsh<sup>2</sup></a><a href=/tags/pycharm/ style=font-size:.88rem>pycharm<sup>1</sup></a><a href=/tags/%E7%BB%88%E7%AB%AF/ style=font-size:.88rem>终端<sup>3</sup></a></div></div><hr></div></div><div id=rightside><div id=rightside-config-hide><button id=readmode type=button title=阅读模式><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id=translateLink type=button title=简繁转换>繁</button><button id=darkmode type=button title=浅色和深色模式转换><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id=hide-aside-btn type=button title=单栏和双栏切换><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id=rightside-config-show><button id=rightside-config type=button title=设置><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class=close id=mobile-toc-button type=button title=目录><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id=go-up type=button title=回到顶部><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id=nav-music><a id=nav-music-hoverTips onclick=anzhiyu.musicToggle() accesskey=m>播放音乐</a><div id=console-music-bg></div><meting-js id=8152976493 server=netease type=playlist mutex=true preload=none theme=var(--anzhiyu-main) data-lrctype=0 order=random volume=0.7></meting-js></div><div id=local-search><div class=search-dialog><nav class=search-nav><span class=search-dialog-title>搜索</span><span id=loading-status></span><button class=search-close-button><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class=is-center id=loading-database><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span> 数据库加载中</span></div><div class=search-wrap><div id=local-search-input><div class=local-search-box><input class=local-search-box--input placeholder=搜索文章 type=text></div></div><hr><div id=local-search-results></div></div></div><div id=search-mask></div></div><div id=rightMenu><div class="rightMenu-group rightMenu-small"><div class=rightMenu-item id=menu-backward><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class=rightMenu-item id=menu-forward><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class=rightMenu-item id=menu-refresh><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style=font-size:1rem></i></div><div class=rightMenu-item id=menu-top><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class=rightMenu-item id=menu-copytext><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class=rightMenu-item id=menu-pastetext><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class=rightMenu-item id=menu-commenttext><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class=rightMenu-item id=menu-newwindow><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class=rightMenu-item id=menu-copylink><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class=rightMenu-item id=menu-copyimg><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class=rightMenu-item id=menu-downloadimg><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class=rightMenu-item id=menu-newwindowimg><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class=rightMenu-item id=menu-search><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class=rightMenu-item id=menu-searchBaidu><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class=rightMenu-item id=menu-music-toggle><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class=rightMenu-item id=menu-music-back><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class=rightMenu-item id=menu-music-forward><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class=rightMenu-item id=menu-music-playlist onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style=display:none><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class=rightMenu-item id=menu-music-copyMusicName><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id=menu-randomPost><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href=/categories/ ><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href=/tags/ ><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class=rightMenu-item id=menu-copy href=javascript:void(0);><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class=rightMenu-item id=menu-commentBarrage href=javascript:void(0);><i class="anzhiyufont anzhiyu-icon-message"></i><span class=menu-commentBarrage-text>关闭热评</span></a><a class=rightMenu-item id=menu-darkmode href=javascript:void(0);><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class=menu-darkmode-text>深色模式</span></a><a class=rightMenu-item id=menu-translate href=javascript:void(0);><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id=rightmenu-mask></div><div><script src=/js/utils.js></script><script src=/js/main.js></script><script src=/js/tw_cn.js></script><script src=https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js></script><script src=https://cdn.cbd.int/instant.page@5.2.0/instantpage.js type=module></script><script src=https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js></script><script src=https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js></script><script>function panguFn(){"object"==typeof pangu?pangu.autoSpacingPage():getScript("https://cdn.cbd.int/pangu@4.0.7/dist/browser/pangu.min.js").then(()=>{pangu.autoSpacingPage()})}function panguInit(){panguFn()}document.addEventListener("DOMContentLoaded",panguInit)</script><canvas id=universe></canvas><script async src=https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js></script><script async src=/anzhiyu/random.js></script><script src=/js/search/local-search.js></script><div class=js-pjax><input type=hidden name=page-type id=page-type value=post></div><script>var visitorMail=""</script><script async data-pjax src=https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js></script><script src=https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js></script><link rel=stylesheet href=https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css><script async src="https://at.alicdn.com/t/c/font_4881188_z81thkys1h.js?spm=a313x.manage_type_myprojects.i1.10.2f1f3a81TL2PFv&amp;file=font_4881188_z81thkys1h.js"></script><link rel=stylesheet href=https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css media=print onload='this.media="all"'><script src=https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js></script><script src=https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js></script><script src=https://cdn.cbd.int/pjax@0.2.8/pjax.min.js></script><script>let pjaxSelectors=["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"];var pjax=new Pjax({elements:'a:not([target="_blank"])',selectors:pjaxSelectors,cacheBust:!1,analytics:!1,scrollRestoration:!1});document.addEventListener("pjax:send",function(){if(anzhiyu.removeGlobalFnEvent("pjax"),anzhiyu.removeGlobalFnEvent("themeChange"),document.getElementById("rightside").classList.remove("rightside-show"),window.aplayers)for(let e=0;e<window.aplayers.length;e++)window.aplayers[e].options.fixed||window.aplayers[e].destroy();"object"==typeof typed&&typed.destroy();var e=document.body.classList;e.contains("read-mode")&&e.remove("read-mode")}),document.addEventListener("pjax:complete",function(){window.refreshFn(),document.querySelectorAll("script[data-pjax]").forEach(e=>{let t=document.createElement("script");var a=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach(e=>t.setAttribute(e.name,e.value)),t.appendChild(document.createTextNode(a)),e.parentNode.replaceChild(t,e)}),GLOBAL_CONFIG.islazyload&&window.lazyLoadInstance.update(),"function"==typeof panguInit&&panguInit(),"function"==typeof gtag&&gtag("config","",{page_path:window.location.pathname}),"object"==typeof _hmt&&_hmt.push(["_trackPageview",window.location.pathname]),"function"==typeof loadMeting&&document.getElementsByClassName("aplayer").length&&loadMeting(),"object"==typeof Prism&&Prism.highlightAll()}),document.addEventListener("pjax:error",e=>{404===e.request.status&&pjax.loadUrl("/404.html")})</script><script charset=UTF-8 src=https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js></script></div><div id=popup-window><div class=popup-window-title>通知</div><div class=popup-window-divider></div><div class=popup-window-content><div class=popup-tip>你好呀</div><div class=popup-link><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>